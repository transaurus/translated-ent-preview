{
  "source_file_path_relative_to_docusaurus_root": "blog/2021-10-14-introducing-entcache.md",
  "source_file_content_hash": "38118b9e498a0dc6be407b2c9e619993340b3b3e69d1f10cd981bd6f3aeb3680",
  "segments": [
    {
      "segment_id": "58cfcc64",
      "source_content": "---\ntitle: Announcing entcache - a Cache Driver for Ent\nauthor: Ariel Mashraki\nauthorURL: \"https://github.com/a8m\"\nauthorImageURL: \"https://avatars0.githubusercontent.com/u/7413593\"\nauthorTwitter: arielmashraki\n---",
      "source_content_hash": "0d59cc482700d019f56fa2ac1491107c6c08117dfb23a0351decad614b3b7041",
      "node_type": "yaml",
      "translatable": false,
      "translations": {
        "zh-CN": "@@untranslatable_placeholder_58cfcc64"
      }
    },
    {
      "segment_id": "53eaf0e1",
      "source_content": "While working on [Ariga's](https://ariga.io) operational data graph query engine, we saw the opportunity to greatly\nimprove the performance of many use cases by building a robust caching library. As heavy users of Ent, it was only\nnatural for us to implement this layer as an extension to Ent. In this post, I will briefly explain what caches are,\nhow they fit into software architectures, and present `entcache` - a cache driver for Ent.",
      "source_content_hash": "6c4bce2135f2b13d9262490afeb26175631eef947275b853356c82c497d1fb8a",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "åœ¨å¼€å‘[Ariga](https://ariga.io)çš„è¿è¥æ•°æ®å›¾è°±æŸ¥è¯¢å¼•æ“æ—¶ï¼Œæˆ‘ä»¬å‘ç°é€šè¿‡æ„å»ºå¥å£®çš„ç¼“å­˜åº“å¯ä»¥æ˜¾è‘—æå‡ä¼—å¤šåœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚ä½œä¸ºEntçš„é‡åº¦ä½¿ç”¨è€…ï¼Œæˆ‘ä»¬å¾ˆè‡ªç„¶åœ°å°†è¿™ä¸€å±‚å®ç°ä¸ºEntçš„æ‰©å±•ã€‚æœ¬æ–‡å°†ç®€è¦ä»‹ç»ç¼“å­˜çš„æ¦‚å¿µã€å…¶åœ¨è½¯ä»¶æ¶æ„ä¸­çš„ä½œç”¨ï¼Œå¹¶å±•ç¤º`entcache`â€”â€”ä¸€ä¸ªä¸“ä¸ºEntè®¾è®¡çš„ç¼“å­˜é©±åŠ¨ã€‚"
      }
    },
    {
      "segment_id": "ad8fd492",
      "source_content": "Caching is a popular strategy for improving application performance. It is based on the observation that the speed for\nretrieving data using different types of media can vary within many orders of magnitude.\n[Jeff Dean](https://twitter.com/jeffdean?lang=en) famously presented the following numbers in a\n[lecture](http://static.googleusercontent.com/media/research.google.com/en/us/people/jeff/stanford-295-talk.pdf) about\n\"Software Engineering Advice from Building Large-Scale Distributed Systems\":",
      "source_content_hash": "609fb2b80563f3cb2a044d9f754ffdffe795de64b49d32d6735b53c919ef9c5a",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "ç¼“å­˜æ˜¯æå‡åº”ç”¨æ€§èƒ½çš„å¸¸ç”¨ç­–ç•¥ï¼Œå…¶åŸç†åŸºäºä¸åŒä»‹è´¨çš„æ•°æ®è¯»å–é€Ÿåº¦å¯èƒ½å­˜åœ¨æ•°é‡çº§å·®å¼‚ã€‚[Jeff Dean](https://twitter.com/jeffdean?lang=en)åœ¨å…³äº\"[æ„å»ºå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„è½¯ä»¶å·¥ç¨‹å»ºè®®](http://static.googleusercontent.com/media/research.google.com/en/us/people/jeff/stanford-295-talk.pdf)\"çš„è‘—åæ¼”è®²ä¸­ï¼Œæ›¾ç»™å‡ºä»¥ä¸‹ç»å…¸æ•°æ®ï¼š"
      }
    },
    {
      "segment_id": "1acb9a05",
      "source_content": "![cache numbers](https://entgo.io/images/assets/entcache/cache-numbers.png)",
      "source_content_hash": "a302b89d6c10c02b9de36c8dc4590618dcec33beddf96e382970ca4bc3f5d321",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "![ç¼“å­˜æ€§èƒ½å¯¹æ¯”](https://entgo.io/images/assets/entcache/cache-numbers.png)"
      }
    },
    {
      "segment_id": "2df4f75f",
      "source_content": "These numbers show things that experienced software engineers know intuitively: reading from memory is faster than\nreading from disk, retrieving data from the same data center is faster than going out to the internet to fetch it.\nWe add to that, that some calculations are expensive and slow, and that fetching a precomputed result can be much faster\n(and less expensive) than recomputing it every time.",
      "source_content_hash": "716b9d388e9e4a5a78c3662a0e48dc0633fec5eff058a78928abeb67cb26ac67",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "è¿™äº›æ•°æ®å°è¯äº†èµ„æ·±å·¥ç¨‹å¸ˆçš„ç›´è§‰è®¤çŸ¥ï¼šå†…å­˜è¯»å–å¿«äºç£ç›˜è®¿é—®ï¼ŒåŒæ•°æ®ä¸­å¿ƒçš„æ•°æ®è·å–å¿«äºäº’è”ç½‘è¯·æ±‚ã€‚æˆ‘ä»¬è¿˜éœ€è¡¥å……çš„æ˜¯ï¼ŒæŸäº›è®¡ç®—è¿‡ç¨‹æœ¬èº«ä»£ä»·é«˜æ˜‚ï¼Œè·å–é¢„è®¡ç®—ç»“æœå¾€å¾€æ¯”å®æ—¶é‡å¤è®¡ç®—æ›´ä¸ºé«˜æ•ˆï¼ˆä¸”æˆæœ¬æ›´ä½ï¼‰ã€‚"
      }
    },
    {
      "segment_id": "a76548f8",
      "source_content": "The collective intelligence of [Wikipedia](https://en.wikipedia.org/wiki/Cache_(computing)) tells us that a Cache is\n\"a hardware or software component that stores data so that future requests for that data can be served faster\".\nIn other words, if we can store a query result in RAM, we can fulfill a request that depends on it much faster than\nif we need to go over the network to our database, have it read data from disk, run some computation on it, and only\nthen send it back to us (over a network).",
      "source_content_hash": "9d175a390df6c4d62ba6a6869833e2b2587dd52d30d3170ef0d5779ef27af355",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Cache_(computing))å°†ç¼“å­˜å®šä¹‰ä¸º\"å­˜å‚¨æ•°æ®ä»¥ä¾¿æœªæ¥è¯·æ±‚èƒ½æ›´å¿«å“åº”çš„ç¡¬ä»¶æˆ–è½¯ä»¶ç»„ä»¶\"ã€‚æ¢è¨€ä¹‹ï¼Œè‹¥èƒ½å°†æŸ¥è¯¢ç»“æœæš‚å­˜äºå†…å­˜ï¼Œå…¶å“åº”é€Ÿåº¦å°†è¿œèƒœäºï¼šé€šè¿‡ç½‘ç»œè®¿é—®æ•°æ®åº“â†’ç£ç›˜è¯»å–â†’æ‰§è¡Œè®¡ç®—â†’ç»“æœå›ä¼ ï¼ˆä»éœ€ç»è¿‡ç½‘ç»œï¼‰çš„å®Œæ•´é“¾è·¯ã€‚"
      }
    },
    {
      "segment_id": "4daf5cdd",
      "source_content": "However, as software engineers, we should remember that caching is a notoriously complicated topic. As the phrase\ncoined by early-day Netscape engineer [Phil Karlton](https://martinfowler.com/bliki/TwoHardThings.html) says: _\"There\nare only two hard things in Computer Science: cache invalidation and naming things\"_. For instance, in systems that rely\non strong consistency, a cache entry may be stale, therefore causing the system to behave incorrectly. For this reason,\ntake great care and pay attention to detail when you are designing caches into your system architectures.",
      "source_content_hash": "edbd041dbdbc5b638455e9704c3b0280798ee21577aed83fb11e01be854b0c24",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "ä½†ä½œä¸ºå·¥ç¨‹å¸ˆå¿…é¡»è°¨è®°ï¼šç¼“å­˜è®¾è®¡æ˜¯å…¬è®¤çš„å¤æ‚é¢†åŸŸã€‚æ­£å¦‚æ—©æœŸç½‘æ™¯å·¥ç¨‹å¸ˆ[Phil Karlton](https://martinfowler.com/bliki/TwoHardThings.html)çš„åè¨€ï¼š\"è®¡ç®—æœºç§‘å­¦åªæœ‰ä¸¤ä»¶éš¾äº‹ï¼šç¼“å­˜å¤±æ•ˆå’Œå‘½å\"ã€‚ä¾‹å¦‚åœ¨å¼ºä¸€è‡´æ€§ç³»ç»Ÿä¸­ï¼Œé™ˆæ—§çš„ç¼“å­˜æ¡ç›®å¯èƒ½å¯¼è‡´ç³»ç»Ÿè¡Œä¸ºå¼‚å¸¸ã€‚å› æ­¤ï¼Œåœ¨æ¶æ„è®¾è®¡ä¸­å¼•å…¥ç¼“å­˜æ—¶ï¼Œå¿…é¡»å®¡æ…è€ƒè™‘æ¯ä¸ªç»†èŠ‚ã€‚"
      }
    },
    {
      "segment_id": "62a6890b",
      "source_content": "### Presenting `entcache`",
      "source_content_hash": "f500b0bf5d67a6a6e6a25ddac57b85721e2f9cba44bbaec05900b940cafc54c8",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "zh-CN": "### ä»‹ç»`entcache`"
      }
    },
    {
      "segment_id": "3cfe6286",
      "source_content": "The `entcache` package provides its users with a new Ent driver that can wrap one of the existing SQL drivers available\nfor Ent. On a high level, it decorates the Query method of the given driver, and for each call:",
      "source_content_hash": "182e8ebd757347ee5d33ff8b8cc2f8d734520dbe698b9684745291ce14af934f",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "`entcache`åŒ…æä¾›äº†ä¸€ä¸ªå¯åŒ…è£…ç°æœ‰Ent SQLé©±åŠ¨çš„æ–°é©±åŠ¨ã€‚å…¶é«˜å±‚é€»è¾‘æ˜¯å¯¹åŸºç¡€é©±åŠ¨çš„Queryæ–¹æ³•è¿›è¡Œè£…é¥°ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ï¼š"
      }
    },
    {
      "segment_id": "aa83231c",
      "source_content": "1. Generates a cache key (i.e. hash) from its arguments (i.e. statement and parameters).\n\n2. Checks the cache to see if the results for this query are already available. If they are (this is called a\n   cache-hit), the database is skipped and results are returned to the caller from memory.\n\n3. If the cache does not contain an entry for the query, the query is passed to the database.\n\n4. After the query is executed, the driver records the raw values of the returned rows (`sql.Rows`), and stores them in\n   the cache with the generated cache key.",
      "source_content_hash": "357be5db540443b9f3e1484462a7afacf262932535f214fa4538222eb3891e1d",
      "node_type": "list",
      "translatable": true,
      "translations": {
        "zh-CN": "1. æ ¹æ®å‚æ•°ï¼ˆè¯­å¥å’Œå‚æ•°ï¼‰ç”Ÿæˆç¼“å­˜é”®ï¼ˆå“ˆå¸Œå€¼ï¼‰\n\n2. æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å·²æœ‰è¯¥æŸ¥è¯¢ç»“æœï¼ˆç¼“å­˜å‘½ä¸­ï¼‰ã€‚è‹¥å­˜åœ¨åˆ™ç›´æ¥è¿”å›å†…å­˜ç»“æœï¼Œè·³è¿‡æ•°æ®åº“æŸ¥è¯¢\n\n3. è‹¥ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™å°†æŸ¥è¯¢ä¼ é€’ç»™åº•å±‚æ•°æ®åº“æ‰§è¡Œ\n\n4. æŸ¥è¯¢æ‰§è¡Œåï¼Œé©±åŠ¨ä¼šè®°å½•è¿”å›è¡Œ(`sql.Rows`)çš„åŸå§‹å€¼ï¼Œå¹¶ä½¿ç”¨ç”Ÿæˆçš„ç¼“å­˜é”®å°†å…¶å­˜å…¥ç¼“å­˜"
      }
    },
    {
      "segment_id": "b36c6338",
      "source_content": "The package provides a variety of options to configure the TTL of the cache entries, control the hash function, provide\ncustom and multi-level cache stores, evict and skip cache entries. See the full documentation in\n[https://pkg.go.dev/ariga.io/entcache](https://pkg.go.dev/ariga.io/entcache).",
      "source_content_hash": "6140dd98edd9baa91a7e733bc1fc54dec44cd1a8c2693866355fd10433353e88",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "è¯¥åŒ…æä¾›å¤šç§é…ç½®é€‰é¡¹ï¼šç¼“å­˜æ¡ç›®TTLã€å“ˆå¸Œå‡½æ•°æ§åˆ¶ã€è‡ªå®šä¹‰å¤šçº§ç¼“å­˜å­˜å‚¨ã€ç¼“å­˜æ·˜æ±°ä¸è·³è¿‡æœºåˆ¶ç­‰ã€‚å®Œæ•´æ–‡æ¡£å‚è§[https://pkg.go.dev/ariga.io/entcache](https://pkg.go.dev/ariga.io/entcache)ã€‚"
      }
    },
    {
      "segment_id": "e536ea0d",
      "source_content": "As we mentioned above, correctly configuring caching for an application is a delicate task, and so `entcache` provides\ndevelopers with different caching levels that can be used with it:",
      "source_content_hash": "bf1fb3d814a6b21a8e7f30ead7285b1ffc819d5a27f3d5d6c178213547d03859",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "å¦‚å‰æ‰€è¿°ï¼Œæ­£ç¡®é…ç½®åº”ç”¨ç¼“å­˜æ˜¯ç²¾ç»†å·¥ä½œï¼Œå› æ­¤`entcache`ä¸ºå¼€å‘è€…æä¾›äº†ä¸åŒå±‚çº§çš„ç¼“å­˜æ–¹æ¡ˆï¼š"
      }
    },
    {
      "segment_id": "3df4f066",
      "source_content": "1. A `context.Context`-based cache. Usually, attached to a request and does not work with other cache levels.\n   It is used to eliminate duplicate queries that are executed by the same request.\n\n2. A driver-level cache used by the `ent.Client`. An application usually creates a driver per database,\n   and therefore, we treat it as a process-level cache.\n\n3. A remote cache. For example, a Redis database that provides a persistence layer for storing and sharing cache\n   entries between multiple processes. A remote cache layer is resistant to application deployment changes or failures,\n   and allows reducing the number of identical queries executed on the database by different process.\n\n4. A cache hierarchy, or multi-level cache allows structuring the cache in hierarchical way. The hierarchy of cache\n   stores is mostly based on access speeds and cache sizes. For example, a 2-level cache that composed of an LRU-cache\n   in the application memory, and a remote-level cache backed by a Redis database.",
      "source_content_hash": "44fb5604ecb555e768c08a419cb22002aee004237dc565269154b9534b2e866f",
      "node_type": "list",
      "translatable": true,
      "translations": {
        "zh-CN": "1. åŸºäº `context.Context` çš„ç¼“å­˜ã€‚é€šå¸¸é™„åŠ åˆ°å•ä¸ªè¯·æ±‚ä¸­ï¼Œä¸ä¸å…¶ä»–ç¼“å­˜å±‚çº§è”åŠ¨ã€‚ç”¨äºæ¶ˆé™¤åŒä¸€è¯·æ±‚å†…é‡å¤æ‰§è¡Œçš„æŸ¥è¯¢ã€‚\n\n2. ç”± `ent.Client` ä½¿ç”¨çš„é©±åŠ¨çº§ç¼“å­˜ã€‚ç”±äºåº”ç”¨é€šå¸¸ä¸ºæ¯ä¸ªæ•°æ®åº“åˆ›å»ºç‹¬ç«‹é©±åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶è§†ä¸ºè¿›ç¨‹çº§ç¼“å­˜ã€‚\n\n3. è¿œç¨‹ç¼“å­˜ã€‚ä¾‹å¦‚ Redis æ•°æ®åº“ï¼Œä¸ºå¤šä¸ªè¿›ç¨‹æä¾›æŒä¹…åŒ–ç¼“å­˜å­˜å‚¨å’Œå…±äº«èƒ½åŠ›ã€‚è¿œç¨‹ç¼“å­˜å±‚èƒ½æŠµå¾¡åº”ç”¨éƒ¨ç½²å˜æ›´æˆ–æ•…éšœï¼Œå¹¶å‡å°‘ä¸åŒè¿›ç¨‹å¯¹æ•°æ®åº“æ‰§è¡Œçš„ç›¸åŒæŸ¥è¯¢ã€‚\n\n4. ç¼“å­˜å±‚æ¬¡ç»“æ„ï¼ˆå¤šçº§ç¼“å­˜ï¼‰å…è®¸ä»¥å±‚çº§æ–¹å¼ç»„ç»‡ç¼“å­˜ã€‚ç¼“å­˜å­˜å‚¨çš„å±‚çº§ä¸»è¦åŸºäºè®¿é—®é€Ÿåº¦å’Œç¼“å­˜å®¹é‡ã€‚ä¾‹å¦‚ï¼šç”±åº”ç”¨å†…å­˜ä¸­çš„ LRU ç¼“å­˜å’Œ Redis æ”¯æ’‘çš„è¿œç¨‹ç¼“å­˜ç»„æˆçš„ä¸¤çº§ç¼“å­˜ã€‚"
      }
    },
    {
      "segment_id": "f01228d3",
      "source_content": "Let's demonstrate this by explaining the `context.Context` based cache.",
      "source_content_hash": "1eeb0f634987f3145956895c6e58626fee1f229305f40f2f09155babccfd4d42",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "æˆ‘ä»¬é€šè¿‡è§£é‡ŠåŸºäº `context.Context` çš„ç¼“å­˜æ¥æ¼”ç¤ºè¿™ä¸€æœºåˆ¶ã€‚"
      }
    },
    {
      "segment_id": "93028a4e",
      "source_content": "### Context-Level Cache",
      "source_content_hash": "1f50c662cb7efca601b0b75bdb5c0ddd3fd2ed68ef03cda4c95f6fcdd1c7bb1f",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "zh-CN": "### ä¸Šä¸‹æ–‡çº§ç¼“å­˜"
      }
    },
    {
      "segment_id": "e8e162a9",
      "source_content": "The `ContextLevel` option configures the driver to work with a `context.Context` level cache. The context is usually\nattached to a request (e.g. `*http.Request`) and is not available in multi-level mode. When this option is used as\na cache store, the attached `context.Context` carries an LRU cache (can be configured differently), and the driver\nstores and searches entries in the LRU cache when queries are executed.",
      "source_content_hash": "e85fd76253a57f2e75875943255a5c9f918d868d1200057192a59294a641be73",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "`ContextLevel` é€‰é¡¹å°†é©±åŠ¨é…ç½®ä¸ºä½¿ç”¨ä¸Šä¸‹æ–‡çº§ç¼“å­˜ã€‚ä¸Šä¸‹æ–‡é€šå¸¸é™„åŠ åˆ°è¯·æ±‚ï¼ˆå¦‚ `*http.Request`ï¼‰ä¸­ï¼Œä¸”ä¸å‚ä¸å¤šçº§ç¼“å­˜æ¨¡å¼ã€‚å½“é‡‡ç”¨æ­¤é€‰é¡¹ä½œä¸ºç¼“å­˜å­˜å‚¨æ—¶ï¼Œé™„å¸¦çš„ `context.Context` ä¼šæºå¸¦ä¸€ä¸ª LRU ç¼“å­˜ï¼ˆå¯é…ç½®å…¶ä»–ç­–ç•¥ï¼‰ï¼Œé©±åŠ¨åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ä¼šåœ¨è¯¥ LRU ç¼“å­˜ä¸­å­˜å‚¨å’Œæ£€ç´¢æ¡ç›®ã€‚"
      }
    },
    {
      "segment_id": "a1fa5396",
      "source_content": "This option is ideal for applications that require strong consistency, but still want to avoid executing duplicate\ndatabase queries on the same request. For example, given the following GraphQL query:",
      "source_content_hash": "eab8802bfab8b54f93e4df887765e09496086d314273a6213ad3e56e3f333328",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "æ­¤é€‰é¡¹éå¸¸é€‚åˆéœ€è¦å¼ºä¸€è‡´æ€§ã€ä½†ä»å¸Œæœ›é¿å…åŒä¸€è¯·æ±‚å†…é‡å¤æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢çš„åº”ç”¨ã€‚ä¾‹å¦‚ä»¥ä¸‹ GraphQL æŸ¥è¯¢ï¼š"
      }
    },
    {
      "segment_id": "b73a4a7a",
      "source_content": "```graphql\nquery($ids: [ID!]!) {\n    nodes(ids: $ids) {\n        ... on User {\n            id\n            name\n            todos {\n                id\n                owner {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n```",
      "source_content_hash": "d1bc8b90091044a523e1b6abeaa3518b0d78385e65be03116b2c278c8eccdd94",
      "node_type": "code",
      "translatable": false,
      "translations": {}
    },
    {
      "segment_id": "2838eb68",
      "source_content": "A naive solution for resolving the above query will execute, 1 for getting N users, another N queries for getting\nthe todos of each user, and a query for each todo item for getting its owner (read more about the\n[_N+1 Problem_](https://entgo.io/docs/tutorial-todo-gql-field-collection/#problem)).",
      "source_content_hash": "5c8697620c9898649cc49f684d66b29150fff9d381e55f3b3eac0d8070b55233",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "åŸå§‹æ–¹æ¡ˆè§£æè¯¥æŸ¥è¯¢éœ€è¦æ‰§è¡Œï¼š1 æ¬¡è·å– N ä¸ªç”¨æˆ·ï¼ŒN æ¬¡è·å–æ¯ä¸ªç”¨æˆ·çš„å¾…åŠäº‹é¡¹ï¼Œä»¥åŠæ¯ä¸ªå¾…åŠäº‹é¡¹å„ 1 æ¬¡è·å–å…¶æ‰€æœ‰è€…ï¼ˆè¯¦ç»†äº†è§£ [_N+1 é—®é¢˜_](https://entgo.io/docs/tutorial-todo-gql-field-collection/#problem)ï¼‰ã€‚"
      }
    },
    {
      "segment_id": "0e80209e",
      "source_content": "However, Ent provides a unique approach for resolving such queries(read more in\n[Ent website](https://entgo.io/docs/tutorial-todo-gql-field-collection)) and therefore, only 3 queries will be executed\nin this case. 1 for getting N users, 1 for getting the todo items of **all** users, and 1 query for getting the owners\nof **all** todo items.",
      "source_content_hash": "1839380288e830631966804073a9a52b8ec21897af463868c01e3f1b73e86d13",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "ä½† Ent æä¾›äº†ç‹¬ç‰¹çš„è§£ææ–¹æ¡ˆï¼ˆè¯¦è§ [Ent å®˜ç½‘](https://entgo.io/docs/tutorial-todo-gql-field-collection)ï¼‰ï¼Œæœ€ç»ˆåªéœ€æ‰§è¡Œ 3 æ¬¡æŸ¥è¯¢ï¼š1 æ¬¡è·å– N ä¸ªç”¨æˆ·ï¼Œ1 æ¬¡è·å–**æ‰€æœ‰**ç”¨æˆ·çš„å¾…åŠäº‹é¡¹ï¼Œ1 æ¬¡è·å–**æ‰€æœ‰**å¾…åŠäº‹é¡¹çš„æ‰€æœ‰è€…ã€‚"
      }
    },
    {
      "segment_id": "3c19e221",
      "source_content": "With `entcache`, the number of queries may be reduced to 2, as the first and last queries are identical (see\n[code example](https://github.com/ariga/entcache/blob/master/internal/examples/ctxlevel/main_test.go)).",
      "source_content_hash": "424a39c3284b33371feb2a8165b284ff65546673a8cf2bc07c29c8b7eead658c",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "ä½¿ç”¨ `entcache` åï¼ŒæŸ¥è¯¢æ¬¡æ•°å¯é™è‡³ 2 æ¬¡ï¼Œå› ä¸ºé¦–å°¾ä¸¤æ¬¡æŸ¥è¯¢å®Œå…¨ä¸€è‡´ï¼ˆå‚è§ [ä»£ç ç¤ºä¾‹](https://github.com/ariga/entcache/blob/master/internal/examples/ctxlevel/main_test.go)ï¼‰ã€‚"
      }
    },
    {
      "segment_id": "1b4de6df",
      "source_content": "![context-level-cache](https://entgo.io/images/assets/entcache/ctxlevel.png)",
      "source_content_hash": "98f367829b9d358d47c33027e7179ddfd5f38aeccf3491872f8821a496714784",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "![ä¸Šä¸‹æ–‡çº§ç¼“å­˜ç¤ºæ„å›¾](https://entgo.io/images/assets/entcache/ctxlevel.png)"
      }
    },
    {
      "segment_id": "1958bc43",
      "source_content": "The different levels are explained in depth in the repository\n[README](https://github.com/ariga/entcache/blob/master/README.md).",
      "source_content_hash": "c38f4ea2b1da405b2efee4455c653f53b9c943a55c340ddd9c8e8287560b1de1",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "å„ç¼“å­˜å±‚çº§çš„è¯¦ç»†è¯´æ˜è¯·å‚é˜…ä»“åº“ [README](https://github.com/ariga/entcache/blob/master/README.md)ã€‚"
      }
    },
    {
      "segment_id": "cbd60296",
      "source_content": "### Getting Started",
      "source_content_hash": "4467215509db0bd0e0f61cf6ee2efa3316c8285b2a46d4449ff85f9ef85923d9",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "zh-CN": "### å¿«é€Ÿå¼€å§‹"
      }
    },
    {
      "segment_id": "c5754696",
      "source_content": "> If you are not familiar with how to set up a new Ent project, complete Ent\n> [Setting Up tutorial](https://entgo.io/docs/tutorial-setup) first.",
      "source_content_hash": "3ffe64812ae3e1677094a365c479efac6bf7dd544b1212457cb2ebae02b85191",
      "node_type": "blockquote",
      "translatable": true,
      "translations": {
        "zh-CN": "> è‹¥æ‚¨ä¸ç†Ÿæ‚‰å¦‚ä½•æ–°å»º Ent é¡¹ç›®ï¼Œè¯·å…ˆå®Œæˆ Ent [å…¥é—¨æ•™ç¨‹](https://entgo.io/docs/tutorial-setup)ã€‚"
      }
    },
    {
      "segment_id": "b9331170",
      "source_content": "First, `go get` the package using the following command.",
      "source_content_hash": "fe5b5b1dca6b4145661dd8979cd6d634c08a40c0d75aa50d3aa9a41a7ca4baac",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "é¦–å…ˆé€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å–è¯¥åŒ…ï¼š"
      }
    },
    {
      "segment_id": "2f34b0ad",
      "source_content": "```shell\ngo get ariga.io/entcache\n```",
      "source_content_hash": "701a1d872d56a1b113816cf4cf03dc210aa18e85cc00991aa2b38202fe51c972",
      "node_type": "code",
      "translatable": false,
      "translations": {}
    },
    {
      "segment_id": "9c9e2b64",
      "source_content": "After installing `entcache`, you can easily add it to your project with the snippet below:",
      "source_content_hash": "8b20bd899196c1930be797424efd7c2dfd2967cf52751b8206c4b3f75177b1c3",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "å®‰è£… `entcache` åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç ç‰‡æ®µå¿«é€Ÿé›†æˆåˆ°é¡¹ç›®ä¸­ï¼š"
      }
    },
    {
      "segment_id": "43cca4d3",
      "source_content": "```go\n// Open the database connection.\ndb, err := sql.Open(dialect.SQLite, \"file:ent?mode=memory&cache=shared&_fk=1\")\nif err != nil {\n\tlog.Fatal(\"opening database\", err)\n}\n// Decorates the sql.Driver with entcache.Driver.\ndrv := entcache.NewDriver(db)\n// Create an ent.Client.\nclient := ent.NewClient(ent.Driver(drv))\n\n// Tell the entcache.Driver to skip the caching layer\n// when running the schema migration.\nif client.Schema.Create(entcache.Skip(ctx)); err != nil {\n\tlog.Fatal(\"running schema migration\", err)\n}\n\n// Run queries.\nif u, err := client.User.Get(ctx, id); err != nil {\n\tlog.Fatal(\"querying user\", err)\n}\n// The query below is cached.\nif u, err := client.User.Get(ctx, id); err != nil {\n\tlog.Fatal(\"querying user\", err)\n}\n```",
      "source_content_hash": "670cd5b1ff9970110f605ac2122eb1bdb2f780a761254a592c9fb05a83c1b0be",
      "node_type": "code",
      "translatable": false,
      "translations": {}
    },
    {
      "segment_id": "d2a3d4c7",
      "source_content": "To see more advanced examples, head over to the repo's\n[examples directory](https://github.com/ariga/entcache/tree/master/internal/examples).",
      "source_content_hash": "392f14687fb301d8f18f9a1bce48adbfaa525dae201bf96ee92bbf0ac85d0553",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "æ›´å¤šé«˜çº§ç¤ºä¾‹è¯·è®¿é—®ä»“åº“çš„ [examples ç›®å½•](https://github.com/ariga/entcache/tree/master/internal/examples)ã€‚"
      }
    },
    {
      "segment_id": "f6a06609",
      "source_content": "### Wrapping Up",
      "source_content_hash": "6df1295c536bdf3cf58241755891051d109001c784cced5b33a00f70983bc553",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "zh-CN": "### æ€»ç»“"
      }
    },
    {
      "segment_id": "6b40e7a2",
      "source_content": "In this post, I presented â€œentcacheâ€ a new cache driver for Ent that I developed while working on [Ariga's Operational\nData Graph](https://ariga.io) query engine. We started the discussion by briefly mentioning the motivation for including\ncaches in software systems. Following that, we described the features and capabilities of `entcache` and concluded with\na short example of how you can set it up in your application.",
      "source_content_hash": "47726cdcdbc1dd21de44ee9cc46ea0bd4acec8b2b708ab9b0acbd3e6afc38491",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "æœ¬æ–‡ä»‹ç»äº†æˆ‘åœ¨å¼€å‘ [Ariga è¿è¥æ•°æ®å›¾è°±](https://ariga.io) æŸ¥è¯¢å¼•æ“æ—¶åˆ›å»ºçš„ Ent ç¼“å­˜é©±åŠ¨ \"entcache\"ã€‚æˆ‘ä»¬é¦–å…ˆè®¨è®ºäº†åœ¨è½¯ä»¶ç³»ç»Ÿä¸­å¼•å…¥ç¼“å­˜çš„åŠ¨æœºï¼Œæ¥ç€é˜è¿°äº† `entcache` çš„ç‰¹æ€§å’Œèƒ½åŠ›ï¼Œæœ€åé€šè¿‡ç®€å•ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°†å…¶é›†æˆåˆ°æ‚¨çš„åº”ç”¨ä¸­ã€‚"
      }
    },
    {
      "segment_id": "d636abf8",
      "source_content": "There are a few features we are working on, and wish to work on, but need help from the community to design them\nproperly (solving cache invalidation, anyone? ;)). If you are interested to contribute, reach out to me on the Ent\nSlack channel.",
      "source_content_hash": "e2be3a88a46eb372d4a4ef531411f909dcf0f8a34eca9747c3ca3b8806394659",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "zh-CN": "æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€äº›åŠŸèƒ½ï¼Œå¹¶å¸Œæœ›ç»§ç»­æ¨è¿›ï¼Œä½†éœ€è¦ç¤¾åŒºå¸®åŠ©æ¥å®Œå–„è®¾è®¡ï¼ˆæ¯”å¦‚ç¼“å­˜å¤±æ•ˆé—®é¢˜ï¼Œæœ‰äººæ„Ÿå…´è¶£å—ï¼ŸğŸ˜‰ï¼‰ã€‚å¦‚æœæ‚¨æœ‰æ„å‚ä¸è´¡çŒ®ï¼Œè¯·åœ¨Entçš„Slacké¢‘é“è”ç³»æˆ‘ã€‚"
      }
    },
    {
      "segment_id": "1699f2b9",
      "source_content": ":::note[For more Ent news and updates:]\n\n- Subscribe to our [Newsletter](https://entgo.substack.com/)\n- Follow us on [Twitter](https://twitter.com/entgo_io)\n- Join us on #ent on the [Gophers Slack](https://entgo.io/docs/slack)\n- Join us on the [Ent Discord Server](https://discord.gg/qZmPgTE6RX)\n\n:::",
      "source_content_hash": "d4f11098ea703d24e53854ec8e2219390959641026efa07de5a588379be52b78",
      "node_type": "containerDirective",
      "translatable": true,
      "translations": {
        "zh-CN": ":::note[è·å–æ›´å¤šEntèµ„è®¯ï¼š]\n\n- è®¢é˜…æˆ‘ä»¬çš„[æ–°é—»é€šè®¯](https://entgo.substack.com/)\n- åœ¨[Twitter](https://twitter.com/entgo_io)å…³æ³¨æˆ‘ä»¬\n- åŠ å…¥[Gophers Slack](https://entgo.io/docs/slack)çš„#enté¢‘é“\n- å‚ä¸[Ent DiscordæœåŠ¡å™¨](https://discord.gg/qZmPgTE6RX)\n\n:::"
      }
    }
  ],
  "target_i18n_subpath": "docusaurus-plugin-content-blog/2021-10-14-introducing-entcache.md",
  "last_updated_timestamp": "2025-06-05T15:16:18.657578+00:00",
  "schema_version": "1.0",
  "translated_versions": {
    "zh-CN": "38118b9e498a0dc6be407b2c9e619993340b3b3e69d1f10cd981bd6f3aeb3680"
  }
}